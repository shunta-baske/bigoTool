<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo App - Top</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <h1>ğŸ’ Bingo App</h1>
    </header>

    <div class="container">
        <div class="card" style="text-align: center;">
            <h2>ã‚ˆã†ã“ã</h2>
            <p style="margin-bottom: 20px;">
                ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§éŠã¹ã‚‹ãƒ“ãƒ³ã‚´ã‚¢ãƒ—ãƒªã§ã™ã€‚<br>
                ã¾ãšã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ï¼ˆã¾ãŸã¯ãƒ­ã‚°ã‚¤ãƒ³ï¼‰ã—ã¦ãã ã•ã„ã€‚
            </p>

            <div style="margin-bottom: 20px;">
                <input type="text" id="registerId" placeholder="å¸Œæœ›ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å…¥åŠ›">
            </div>
            <button id="registerBtn" onclick="registerUser()">æ–°ã—ããƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã—ã¦å§‹ã‚ã‚‹</button>

            <div style="margin-top: 30px; border-top: 1px solid var(--border); padding-top: 20px;">
                <p>ã™ã§ã«IDã‚’ãŠæŒã¡ã®æ–¹ã¯ã“ã¡ã‚‰ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³</p>
                <input type="text" id="loginId" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å…¥åŠ›">
                <button onclick="loginUser()">ãƒ­ã‚°ã‚¤ãƒ³</button>
            </div>
        </div>

        <nav>
            <a href="#" onclick="showAdminLogin(); return false;">ç®¡ç†è€…ãƒšãƒ¼ã‚¸ã¯ã“ã¡ã‚‰</a>
        </nav>

        <div id="adminLoginArea" class="card" style="display: none; margin-top: 20px; text-align: center;">
            <h2>ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</h2>
            <input type="password" id="adminIdInput" placeholder="ç®¡ç†è€…IDã‚’å…¥åŠ›">
            <button onclick="loginAdmin()">ãƒ­ã‚°ã‚¤ãƒ³</button>
        </div>
    </div>

    <script>
        // Check if already logged in
        window.onload = () => {
            const existingId = localStorage.getItem('bingoUserId');
            if (existingId) {
                window.location.href = 'mypage.html';
            }
        };

        async function registerUser() {
            const idInput = document.getElementById('registerId').value.trim();
            if (!idInput) {
                alert('å¸Œæœ›ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            if (idInput === 'useradmin') {
                alert('ã“ã®IDã¯ç™»éŒ²ã§ãã¾ã›ã‚“ã€‚');
                return;
            }

            const btn = document.getElementById('registerBtn');
            btn.disabled = true;
            btn.innerText = 'ç™»éŒ²ä¸­...';

            try {
                const res = await fetch('/api/users/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: idInput })
                });
                if (res.ok) {
                    const user = await res.json();
                    localStorage.setItem('bingoUserId', user.id);
                    window.location.href = 'mypage.html';
                } else if (res.status === 409) {
                    alert('æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹IDã§ã™');
                    window.location.href = 'index.html';
                } else {
                    alert('ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                    btn.disabled = false;
                    btn.innerText = 'æ–°ã—ããƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã—ã¦å§‹ã‚ã‚‹';
                }
            } catch (e) {
                alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
                btn.disabled = false;
                btn.innerText = 'æ–°ã—ããƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã—ã¦å§‹ã‚ã‚‹';
            }
        }

        async function loginUser() {
            const id = document.getElementById('loginId').value.trim();
            if (!id) {
                alert('IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            if (id.length === 0) {
                alert('ç„¡åŠ¹ãªIDãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã™ã€‚');
                return;
            }

            if (id === 'useradmin') {
                alert('ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ã¯ãƒ­ã‚°ã‚¤ãƒ³ã§ãã¾ã›ã‚“ã€‚ã€Œç®¡ç†è€…ãƒšãƒ¼ã‚¸ã¯ã“ã¡ã‚‰ã€ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            try {
                const res = await fetch(`/api/users/${id}`);
                if (res.ok) {
                    localStorage.setItem('bingoUserId', id);
                    window.location.href = 'mypage.html';
                } else {
                    alert('ç™»éŒ²ã•ã‚Œã¦ã„ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã§ã™ã€‚');
                }
            } catch (e) {
                alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
            }
        }

        function showAdminLogin() {
            document.getElementById('adminLoginArea').style.display = 'block';
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }

        function loginAdmin() {
            const id = document.getElementById('adminIdInput').value.trim();
            if (id === 'useradmin') {
                localStorage.setItem('bingoUserId', id);
                window.location.href = 'admin.html';
            } else {
                alert('ç®¡ç†è€…IDãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚');
            }
        }
    </script>
</body>

</html>